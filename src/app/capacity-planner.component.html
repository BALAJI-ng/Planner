<div class="capacity-planner">
  <div class="section-header">
    <span class="section-title">Capacity Plan</span>
  </div>
  <div *ngIf="forecastRows.length > 0">
    <table class="plan-table">
      <thead>
        <tr>
          <th class="sticky-col sticky-label">Row Label</th>
          <ng-container *ngFor="let column of columns; let i = index">
            <th *ngIf="i === 1" class="sticky-col sticky-total">
              {{ column }}
            </th>
            <th *ngIf="i > 1">{{ column }}</th>
          </ng-container>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of forecastRows; let rowIdx = index">
          <td class="sticky-col sticky-label">
            {{ row.forecastColumns[0].rowLabel || "" }}
          </td>
          <ng-container *ngFor="let col of row.forecastColumns; let i = index">
            <td
              *ngIf="i === 1"
              class="sticky-col sticky-total"
              [ngClass]="col.cellCss"
            >
              <!-- Remaining Capacity: show calculated total -->
              <ng-container *ngIf="row.forecastColumns[0].rowLabel === 'Remaining Capacity'">
                {{ getRowTotal(row) }}
              </ng-container>
              <!-- RTB and CTB: show calculated total -->
              <ng-container *ngIf="isTotalDynamic(row.forecastColumns[0].rowLabel) && row.forecastColumns[0].rowLabel !== 'Remaining Capacity'">
                {{ getRowTotal(row) }}
              </ng-container>
              <!-- Other rows: show static value -->
              <ng-container *ngIf="!isTotalDynamic(row.forecastColumns[0].rowLabel)">
                {{ col.amount != null ? col.amount : 0 }}
              </ng-container>
            </td>
            <td *ngIf="i > 1" [ngClass]="col.cellCss">
              <!-- Editable for RTB and CTB rows, current or future month -->
              <ng-container *ngIf="isEditable(row.forecastColumns[0].rowLabel, col.month, col.year)">
                <input type="number" [ngModel]="col.amount"
                  (ngModelChange)="onAmountChange(row, col, i, $event)"
                  [min]="0" />
              </ng-container>
              <ng-container *ngIf="!isEditable(row.forecastColumns[0].rowLabel, col.month, col.year)">
                <!-- Remaining Capacity: show calculated value -->
                <ng-container *ngIf="row.forecastColumns[0].rowLabel === 'Remaining Capacity'">
                  {{ getRemainingCapacityAmount(i) }}
                </ng-container>
                <!-- Other rows: show static value -->
                <ng-container *ngIf="row.forecastColumns[0].rowLabel !== 'Remaining Capacity'">
                  {{ col.amount != null ? col.amount : 0 }}
                </ng-container>
              </ng-container>
            </td>
          </ng-container>
        </tr>
      </tbody>
    </table>
  </div>
  <p-toast></p-toast>
</div>
